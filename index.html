<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kata CI Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="project-selector">
          <button class="project-btn active" data-project="kata">
            <img src="kata-icon.svg" alt="Kata Containers" class="project-logo kata-icon">
            <span class="project-name">Kata Containers</span>
          </button>
          <button class="project-btn" data-project="coco">
            <img src="coco-logo.svg" alt="Confidential Containers" class="project-logo coco-logo">
            <span class="project-name">Confidential Containers</span>
          </button>
        </div>
      </div>
      <div class="header-right">
        <span class="last-refresh">Last updated: <strong id="last-refresh-time">‚Äî</strong></span>
      </div>
    </header>

    <!-- Kata Containers Content -->
    <div class="project-content active" id="kata-content">
      <!-- Tabs -->
      <nav class="tabs">
        <button class="tab active" data-tab="nightly">
          <span class="tab-icon">üåô</span>
          Nightly CI
        </button>
        <button class="tab" data-tab="prfailures">
          <span class="tab-icon">üî¥</span>
          PR Failures
          <span class="tab-badge" id="flaky-count-badge" style="display: none;">0</span>
        </button>
      </nav>

    <!-- Rename Warnings (shown when job renames detected) -->
    <div id="rename-warnings" style="display: none;"></div>

    <!-- Main Content - Nightly Tab -->
    <main class="content tab-content active" id="nightly-content">
      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="stat">
          <span class="stat-value" id="total-tests">0</span>
          <span class="stat-label">Total Tests</span>
        </div>
        <div class="stat stat-failed">
          <span class="stat-value" id="failed-tests">0</span>
          <span class="stat-label">Failed</span>
        </div>
        <div class="stat stat-not-run">
          <span class="stat-value" id="not-run-tests">0</span>
          <span class="stat-label">Not Run</span>
        </div>
        <div class="stat stat-passed">
          <span class="stat-value" id="passed-tests">0</span>
          <span class="stat-label">Passed</span>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="search-tests" placeholder="Search jobs...">
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="failed">
            <span class="dot dot-failed"></span> Failed (<span id="filter-failed-count">8</span>)
          </button>
          <button class="filter-btn" data-filter="not_run">
            <span class="dot dot-not-run"></span> Not Run (<span id="filter-not-run-count">5</span>)
          </button>
          <button class="filter-btn" data-filter="passed">
            <span class="dot dot-passed"></span> Passed (<span id="filter-passed-count">114</span>)
          </button>
        </div>
      </div>

      <!-- Job Category Filters -->
      <div class="category-filters">
        <div class="category-toggle">
          <button class="category-btn active" data-category="all">All</button>
          <button class="category-btn" data-category="required">Required</button>
        </div>
        <div class="category-quick-filters">
          <button class="quick-filter-btn" data-category="tee">
            <span class="quick-filter-icon">üîê</span>
            <span class="quick-filter-label">TEE</span>
            <span class="quick-filter-desc">HW / Dev</span>
          </button>
          <button class="quick-filter-btn" data-category="nvidia">
            <span class="quick-filter-icon nvidia-icon"></span>
            <span class="quick-filter-label">NVIDIA</span>
            <span class="quick-filter-desc">GPU & CC</span>
          </button>
          <button class="quick-filter-btn" data-category="ibm">
            <span class="quick-filter-icon">üñ•Ô∏è</span>
            <span class="quick-filter-label">IBM</span>
            <span class="quick-filter-desc">s390x</span>
          </button>
        </div>
      </div>

      <!-- Job Count -->
      <div class="job-count-display">
        <span id="job-count-text">Showing <strong id="visible-jobs">0</strong> of <strong id="total-jobs">0</strong> jobs</span>
      </div>

      <!-- Date Display -->
      <div class="date-header">
        <h2>Nightly Runs ‚Äî <span id="current-date">November 28, 2025</span></h2>
      </div>

      <!-- Sections -->
      <div class="sections" id="sections-container">
        <!-- Sections will be rendered by JavaScript -->
      </div>
    </main>

    <!-- Main Content - PR Failures Tab -->
    <main class="content tab-content" id="prfailures-content">
      <!-- PR Failures Stats -->
      <div class="quick-stats">
        <div class="stat stat-failed">
          <span class="stat-value" id="prfailures-flaky">0</span>
          <span class="stat-label">üîÑ Flaky Tests</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="prfailures-total">0</span>
          <span class="stat-label">Total Failures</span>
        </div>
        <div class="stat stat-passed">
          <span class="stat-value" id="prfailures-prs">0</span>
          <span class="stat-label">PRs Analyzed</span>
        </div>
      </div>

      <!-- Filters (same position as Nightly) -->
      <div class="filters">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="search-flaky" placeholder="Search tests or jobs...">
        </div>
        <div class="sub-tabs-inline">
          <button class="sub-tab active" data-subtab="by-test">üî• By Test</button>
          <button class="sub-tab" data-subtab="by-job">üìä By Job</button>
        </div>
      </div>

      <!-- By Test View -->
      <div class="sub-tab-content active" id="by-test-content">
        <p class="section-subtitle">Click a test to see failed runs for debugging</p>
        <div id="flaky-by-test-list">
          <!-- Rendered by JS -->
        </div>
      </div>

      <!-- By Job View -->
      <div class="sub-tab-content" id="by-job-content">
        <p class="section-subtitle">Click a job to see its flaky tests and failed runs</p>
        <div id="flaky-by-job-list">
          <!-- Rendered by JS -->
        </div>
      </div>
    </main>
    </div><!-- End Kata Containers Content -->

    <!-- Confidential Containers Content -->
    <div class="project-content" id="coco-content">
      <!-- CoCo Sub-project Tabs -->
      <nav class="tabs">
        <button class="tab active" data-tab="coco-charts">
          <span class="tab-icon">‚éà</span>
          Charts
        </button>
        <button class="tab" data-tab="coco-caa">
          <span class="tab-icon">‚òÅÔ∏è</span>
          Cloud API Adaptor
        </button>
      </nav>

      <!-- CoCo Charts Content -->
      <main class="content tab-content active" id="coco-charts-content">
        <!-- Quick Stats -->
        <div class="quick-stats">
          <div class="stat">
            <span class="stat-value" id="coco-total-tests">0</span>
            <span class="stat-label">Total Tests</span>
          </div>
          <div class="stat stat-failed">
            <span class="stat-value" id="coco-failed-tests">0</span>
            <span class="stat-label">Failed</span>
          </div>
          <div class="stat stat-passed">
            <span class="stat-value" id="coco-passed-tests">0</span>
            <span class="stat-label">Passed</span>
          </div>
        </div>

        <!-- Filters -->
        <div class="filters">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="search-coco-tests" placeholder="Search E2E tests...">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn coco-filter active" data-filter="all">All</button>
            <button class="filter-btn coco-filter" data-filter="failed">
              <span class="dot dot-failed"></span> Failed (<span id="coco-filter-failed-count">0</span>)
            </button>
            <button class="filter-btn coco-filter" data-filter="not_run">
              <span class="dot dot-not-run"></span> Not Run (<span id="coco-filter-not-run-count">0</span>)
            </button>
            <button class="filter-btn coco-filter" data-filter="passed">
              <span class="dot dot-passed"></span> Passed (<span id="coco-filter-passed-count">0</span>)
            </button>
          </div>
        </div>

        <!-- Job Count -->
        <div class="job-count-display">
          <span>Showing <strong id="coco-visible-jobs">0</strong> of <strong id="coco-total-jobs">0</strong> E2E tests</span>
        </div>

        <!-- Date Display -->
        <div class="date-header">
          <h2>Nightly E2E Runs ‚Äî <span id="coco-current-date">November 28, 2025</span></h2>
          <p class="section-subtitle">
            <a href="https://github.com/confidential-containers/charts" target="_blank">confidential-containers/charts</a>
          </p>
        </div>

        <!-- Sections -->
        <div class="sections" id="coco-sections-container">
          <!-- CoCo sections will be rendered by JavaScript -->
        </div>
      </main>

      <!-- CoCo Cloud API Adaptor Content -->
      <main class="content tab-content" id="coco-caa-content">
        <!-- Quick Stats -->
        <div class="quick-stats">
          <div class="stat">
            <span class="stat-value" id="caa-total-tests">0</span>
            <span class="stat-label">Total Tests</span>
          </div>
          <div class="stat stat-failed">
            <span class="stat-value" id="caa-failed-tests">0</span>
            <span class="stat-label">Failed</span>
          </div>
          <div class="stat stat-passed">
            <span class="stat-value" id="caa-passed-tests">0</span>
            <span class="stat-label">Passed</span>
          </div>
        </div>

        <!-- Filters -->
        <div class="filters">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="search-caa-tests" placeholder="Search E2E tests...">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn caa-filter active" data-filter="all">All</button>
            <button class="filter-btn caa-filter" data-filter="failed">
              <span class="dot dot-failed"></span> Failed (<span id="caa-filter-failed-count">0</span>)
            </button>
            <button class="filter-btn caa-filter" data-filter="not_run">
              <span class="dot dot-not-run"></span> Not Run (<span id="caa-filter-not-run-count">0</span>)
            </button>
            <button class="filter-btn caa-filter" data-filter="passed">
              <span class="dot dot-passed"></span> Passed (<span id="caa-filter-passed-count">0</span>)
            </button>
          </div>
        </div>

        <!-- Job Count -->
        <div class="job-count-display">
          <span>Showing <strong id="caa-visible-jobs">0</strong> of <strong id="caa-total-jobs">0</strong> E2E tests</span>
        </div>

        <!-- Date Display -->
        <div class="date-header">
          <h2>Daily E2E Runs ‚Äî <span id="caa-current-date">November 28, 2025</span></h2>
          <p class="section-subtitle">
            <a href="https://github.com/confidential-containers/cloud-api-adaptor" target="_blank">confidential-containers/cloud-api-adaptor</a>
          </p>
        </div>

        <!-- Sections -->
        <div class="sections" id="caa-sections-container">
          <!-- CAA sections will be rendered by JavaScript -->
        </div>
      </main>

      <!-- CoCo Cloud API Adaptor Content -->
      <main class="content tab-content" id="coco-caa-content">
        <!-- Quick Stats -->
        <div class="quick-stats">
          <div class="stat">
            <span class="stat-value" id="caa-total-tests">0</span>
            <span class="stat-label">Total Tests</span>
          </div>
          <div class="stat stat-failed">
            <span class="stat-value" id="caa-failed-tests">0</span>
            <span class="stat-label">Failed</span>
          </div>
          <div class="stat stat-passed">
            <span class="stat-value" id="caa-passed-tests">0</span>
            <span class="stat-label">Passed</span>
          </div>
        </div>

        <!-- Filters -->
        <div class="filters">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="search-caa-tests" placeholder="Search E2E tests...">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn caa-filter active" data-filter="all">All</button>
            <button class="filter-btn caa-filter" data-filter="failed">
              <span class="dot dot-failed"></span> Failed (<span id="caa-filter-failed-count">0</span>)
            </button>
            <button class="filter-btn caa-filter" data-filter="not_run">
              <span class="dot dot-not-run"></span> Not Run (<span id="caa-filter-not-run-count">0</span>)
            </button>
            <button class="filter-btn caa-filter" data-filter="passed">
              <span class="dot dot-passed"></span> Passed (<span id="caa-filter-passed-count">0</span>)
            </button>
          </div>
        </div>

        <!-- Job Count -->
        <div class="job-count-display">
          <span>Showing <strong id="caa-visible-jobs">0</strong> of <strong id="caa-total-jobs">0</strong> E2E tests</span>
        </div>

        <!-- Date Display -->
        <div class="date-header">
          <h2>Daily E2E Runs ‚Äî <span id="caa-current-date">November 28, 2025</span></h2>
          <p class="section-subtitle">
            <a href="https://github.com/confidential-containers/cloud-api-adaptor" target="_blank">confidential-containers/cloud-api-adaptor</a>
          </p>
        </div>

        <!-- Sections -->
        <div class="sections" id="caa-sections-container">
          <!-- CAA sections will be rendered by JavaScript -->
        </div>
      </main>
    </div><!-- End CoCo Content -->

    <!-- Error Modal -->
    <div class="modal" id="error-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">Error Details</h3>
          <button class="modal-close" id="modal-close">‚úï</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Error details will be inserted here -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="copy-error">üìã Copy Error</button>
          <a class="btn btn-secondary" id="github-log-link" href="#" target="_blank">üîó View Full Log</a>
        </div>
      </div>
    </div>

    <!-- Weather Modal -->
    <div class="modal" id="weather-modal">
      <div class="modal-content modal-weather">
        <div class="modal-header">
          <h3 id="weather-modal-title">Weather Details</h3>
          <button class="modal-close" id="weather-close">‚úï</button>
        </div>
        <div class="modal-body" id="weather-modal-body">
          <!-- Weather details will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
      <span class="toast-message"></span>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>

